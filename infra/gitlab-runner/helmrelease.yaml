---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: gitlab-runner
  namespace: flux-system
spec:
  releaseName: gitlab-runner
  targetNamespace: gitlab
  install:
    createNamespace: true
  interval: 15m
  chart:
    spec:
      # gitlab-runner: registryUrl=https://charts.gitlab.io
      chart: gitlab-runner
      version: 0.49.2
      sourceRef:
        kind: HelmRepository
        name: gitlab
        namespace: flux-system
      interval: 15m

  values:
    gitlabUrl: https://gitlab.com/
    rbac:
      create: true
    runners:
      config: |
        [[runners]]
          [runners.kubernetes]
            image = "ubuntu:18.04"
          [[runners.kubernetes.volumes.empty_dir]]
            name = "docker-certs"
            mount_path = "/certs/client"
            medium = "Memory"
      secret: gitlab-runner
      locked: true
      protected: true
      privileged: true

